tosca_definitions_version: tosca_simple_yaml_1_3
description: A TOSCA template to implement the connectivity service required between an EV Charging Station and a Charging Station Management System as part of 5G Riders on the Storm 2020 Catalyst for TMForum

metadata:
  # The following fields are "normative" and expected in TOSCA 
  template_name: CS to CSMS connectivity
  template_author: paul.m.jordan@bt.com
  template_version: '2.0'

imports:
  # - https://github.com/pmjordan/TOSCA_for_TMForum/blob/master/sid.yml
  # would normally refer to external repository but for now make it local
  - file: ../../../../TOSCA_for_TMForum/sid.yml
  # The content is a TOSCA encoding of selected SID information model entities as explained in IG1176
    namespace_prefix: sid

# This file is built on the that the change over from fixed connection to a slice is under control of the service provider.

capability_types:
  QoS1:
    description: >-
      Some mix of speed, latency etc.
    derived_from: tosca.capabilities.Root

# Define Node Types, one each for fixed and slice
node_types:
  CS_CSMS_connection:
    description: assured connection using combination of fixed and wireless
    derived_from: # resource function

  fixed_connection:
    description: connection between two endpoints over a fixed connection
    derived_from: sid:tosca.nodes.org.tmforum.models.sidmodels.ResourceDomain.ResourceABE.CompoundResourceABE.CompoundResource
    capabilities:
      # There are always two external interfaces
      a_end: Endpoint 
      z-end: Endpoint

  wireless_connection:
    description: connection between two endpoints over a wireless connection
    derived_from: sid:tosca.nodes.org.tmforum.models.sidmodels.ResourceDomain.ResourceABE.CompoundResourceABE.CompoundResource
    requirements:
      # state the resources needed to make the connection over a slice. A slice will need to be created if it doesn't exist
      # Note that here we don't mind if the slice is standard or dedicated
      - slice:
          capability: QoS1
          node: 5G_slice
          relationship: DependsOn
    capabilities:
      # There are always two external interfaces
      a_end: Endpoint 
      z-end: Endpoint

  5G_slice:
    description: An abstract class for a network capable of supporting multiple point to point connection at a given qos
    derived_from: sid:tosca.nodes.org.tmforum.models.sidmodels.ResourceDomain.ResourceABE.CompoundResourceABE.CompoundResource
    capabilities:
      QoSForThisSlice: QoS1

  standard_5G_slice:
    description: A concrete class for a general purpose slice
    derived_from: 5G_slice
      
  dedicated_5G_slice:
    description: A oncrete class for a slice dedicated to Charging station to charge station management connections in areas which are under imminent threat of a weather event
    derived_from: 5G_slice
    capabilities:
      # TODO some extra capabilities or QoS refinements

topology_template:

my_CS_CSMS_connection:
  type: CS_CSMS_connection

  workflow:
    connection_request:
      # TODO create a fixed connection
      # TODO if fixed connection status is failed then invoke fixed failure workflow
    connection_cease:
      # TODO if wireless connection exists then destroy it
      # TODO destroy fixed connection
    fixed_connection_failure:
      # TODO if CS is on the list
        # TODO if dedicated slice does not exist create it
      # TODO create wireless connection
    fixed_connection_restoration:
      # TODO if wireless connection exists then cease it
      # TODO destroy fixed connection

  policy:
    fixed_connection_failure_event:
      # TODO run workflow for fixed_connection_failure
    fixed_connection_restoration_event:
      # TODO wait ab bit and check fixed connection is still restored
      # TODO run workflow for fixed_connection_restoration


