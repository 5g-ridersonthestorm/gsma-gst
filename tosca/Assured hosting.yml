tosca_definitions_version: tosca_simple_yaml_1_3
description: A TOSCA template to implement migration of cloud based app server software from cloud to specific MEC DCs. First used as part of 5G Riders on the Storm 2020 Catalyst for TMForum for hosting WheresMyChargePoint

metadata:
  # The following fields are "normative" and expected in TOSCA 
  template_name: AssuredHosting
  template_author: paul.m.jordan@bt.com
  template_version: '1.1'

repositories:
  myRepository:
    description: Location where app image files are stored
    # all images mentioned in this template must be in the same repo as TOSCA cannot use a variable for the repo location in the topology template
    url: http:/cantmakethisavariable.com
    credential: 
      protocol: http
      token_type: basic_auth
      # Username and password are combined into a string
      # Note: this would be base64 encoded before transmission by any impl.
      token: myusername:mypassword

node_types:
  myapp_type:
    derived_from: tosca.nodes.SoftwareComponent
    interfaces:
      Standard:
        operations:
          create:
            inputs:
              create_zip: 
                type: string
  

topology_template:


  node_templates:
    myApp:
      #as this is a classic VNF we have a choice of how to model it. Could be based on TOSCA node types, SID software entities or ETSI VNFs. Depends on what is easiest for the orchestrator vendor. We have chosen TOSCA native
      type: myapp_type #tosca.nodes.SoftwareComponent
      requirements:
        # SoftwareComponent requires hosting on Compute by definition but supplement that requirement for an abstract node
        - host: myapp_compute

      interfaces:
        Standard:
          operations:
            create: 
              implementation: scripts/create.sh
              inputs:
                create_zip: { get_artifact: [ SELF, myapp_artifact ] }
              
      artifacts:
        myapp_artifact: 
          type: tosca:Deployment.Image
          file: a_filename_which_cannot_be_a_variable
          repository: myRepository
    
    # Abstract node template (placeholder) to be selected by provider        
    myapp_compute:
      type : tosca.nodes.Compute
      directives: [ select ]
      # This node_filter is required by commented out awaiting a fix for puccini issue #34
      # node_filter:
      #   capabilities:
      #     - host:
      #         attributes:
      #           - private_address: { equal: {get_input: [ targetComputeAdminAddress ] }}


  